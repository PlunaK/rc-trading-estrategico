<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RC • Dashboard – Bloque 1</title>
  <style>
    :root {
      --bg: #0a0a0a; --card: #121212; --muted: #bdbdbd; --text: #ffffff; --accent: #00aaff; --accent2:#0077cc;
    }
    * { box-sizing: border-box; }
    body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Segoe UI', system-ui, sans-serif; }
    header { display:flex; align-items:center; justify-content:space-between; padding:16px 20px; border-bottom:1px solid #1f1f1f; position:sticky; top:0; background:rgba(10,10,10,.9); backdrop-filter: blur(6px); }
    header .brand { display:flex; gap:12px; align-items:center; }
    header img { width:38px; height:38px; border-radius:8px; object-fit:cover; }
    header h1 { font-size:18px; margin:0; letter-spacing:.4px; color: var(--accent); }
    header .user { font-size:12px; color: var(--muted); }
    header .actions { display:flex; gap:8px; }
    button, .btn { background: var(--accent2); color: #fff; border:none; border-radius:8px; padding:10px 14px; cursor:pointer; font-weight:600; }
    button:hover { filter:brightness(1.05); }

    .layout { display:grid; grid-template-columns: 320px 1fr; min-height: calc(100vh - 70px); }

    /* Sidebar */
    aside { border-right:1px solid #1f1f1f; padding:16px; background:#0e0e0e; }
    .block-title { font-size:14px; color:#9ad8ff; margin:8px 0 6px; }
    .progress { background:#161616; border:1px solid #222; border-radius:12px; padding:12px; margin-bottom:16px; }
    .progress .bar { height:8px; background:#222; border-radius:30px; overflow:hidden; }
    .progress .fill { height:100%; width:0%; background:var(--accent); transition: width .3s ease; }
    .progress .label { font-size:12px; color:var(--muted); margin-top:8px; display:flex; justify-content:space-between; }

    .lesson-list { display:flex; flex-direction:column; gap:8px; }
    .lesson { display:flex; align-items:center; gap:10px; padding:10px; border:1px solid #222; background:#121212; border-radius:10px; cursor:pointer; }
    .lesson:hover { border-color:#2a2a2a; }
    .lesson input { accent-color: var(--accent); }
    .lesson .name { font-size:14px; }
    .lesson .dur { font-size:12px; color:var(--muted); margin-left:auto; }

    /* Main */
    main { padding:20px; }
    .card { background:var(--card); border:1px solid #202020; border-radius:16px; padding:18px; }
    .title { font-size:22px; margin:0 0 6px; }
    .subtitle { font-size:13px; color:var(--muted); margin:0 0 16px; }
    .player { aspect-ratio:16/9; width:100%; background:#0c0c0c; border:1px dashed #2a2a2a; border-radius:12px; display:grid; place-items:center; color:#7a7a7a; font-size:14px; }
  </style>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
</head>
<body>
  <header>
    <div class="brand">
      <img src="logo.jpeg" alt="RC" />
      <div>
        <h1>RC – Trading Estratégico</h1>
        <div class="user" id="userEmail">Cargando usuario…</div>
      </div>
    </div>
    <div class="actions">
      <button onclick="window.location.href='inicio.html'">Inicio</button>
      <button id="logoutBtn">Cerrar sesión</button>
    </div>
  </header>

  <div class="layout">
    <aside>
      <div class="progress">
        <div class="label"><span>Progreso</span><span id="pLabel">0%</span></div>
        <div class="bar"><div class="fill" id="pFill"></div></div>
      </div>

      <div class="block">
        <div class="block-title">Bloque 1 • Plataformas y Herramientas Básicas</div>
        <div class="lesson-list" id="lessons">
          <label class="lesson"><input type="checkbox" data-id="tv"/> <span class="name">Tutorial TradingView</span> <span class="dur">31:08</span></label>
          <label class="lesson"><input type="checkbox" data-id="chart"/> <span class="name">Representación gráfica del precio</span> <span class="dur">12:35</span></label>
          <label class="lesson"><input type="checkbox" data-id="sr"/> <span class="name">Soportes y Resistencias</span> <span class="dur">8:27</span></label>
          <label class="lesson"><input type="checkbox" data-id="trend"/> <span class="name">Líneas de tendencia y canales</span> <span class="dur">11:40</span></label>
          <label class="lesson"><input type="checkbox" data-id="vrvp"/> <span class="name">VRVP</span> <span class="dur">16:03</span></label>
        </div>
      </div>
    </aside>

    <main>
      <!-- Presentación general de todos los módulos -->
      <div class="card" style="margin-bottom:16px">
        <h2 class="title">Presentación general del programa</h2>
        <p class="subtitle">Video introductorio con el objetivo, estructura y cómo usar cada bloque.</p>
        <div class="player" id="introPlayer"></div>
      </div>

      <div class="card">
        <h2 class="title" id="lessonTitle">Seleccioná una lección</h2>
        <p class="subtitle" id="lessonSub">Hacé clic en una lección del Bloque 1 para verla aquí.</p>
        <div class="player" id="player">Video/Material de la lección</div>
      </div>
    </main>
  </div>

  <script>
    // 1) Firebase Auth
    const firebaseConfig = {
      apiKey: "AIzaSyBWfsfIOOFauruoaFF4kzKqhFoOoEdur9I",
      authDomain: "rc-trading-estrategico.firebaseapp.com",
      projectId: "rc-trading-estrategico",
      storageBucket: "rc-trading-estrategico.firebasestorage.app",
      messagingSenderId: "13444936588",
      appId: "1:13444936588:web:8153ac520372ab6b6cb739"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // 2) Proteger ruta
    auth.onAuthStateChanged((user) => {
      if (!user) { window.location.href = 'index.html'; return; }
      if (!user.emailVerified) { alert('Verificá tu email para acceder.'); auth.signOut(); return; }
      document.getElementById('userEmail').textContent = user.email;
    });

    // 3) Logout
    document.getElementById('logoutBtn').addEventListener('click', () => auth.signOut().then(()=>window.location.href='index.html'));

    // 4) Progreso con localStorage
    const boxes = Array.from(document.querySelectorAll('#lessons input[type="checkbox"]'));
    const KEY = 'rc_progress_block1';
    const saved = JSON.parse(localStorage.getItem(KEY) || '{}');
    boxes.forEach(b => { if (saved[b.dataset.id]) b.checked = true; });

    function updateProgress(){
      const total = boxes.length;
      const done = boxes.filter(b=>b.checked).length;
      const pct = Math.round((done/total)*100);
      document.getElementById('pFill').style.width = pct + '%';
      document.getElementById('pLabel').textContent = pct + '%';
      const data = {}; boxes.forEach(b=> data[b.dataset.id] = b.checked);
      localStorage.setItem(KEY, JSON.stringify(data));
    }
    boxes.forEach(b => b.addEventListener('change', updateProgress));
    updateProgress();

    // 5) Videos
    const titleEl = document.getElementById('lessonTitle');
    const subEl = document.getElementById('lessonSub');
    const player = document.getElementById('player');
    document.getElementById('lessons').addEventListener('click', (e)=>{
      const item = e.target.closest('.lesson'); if (!item) return;
      const name = item.querySelector('.name').textContent;
      titleEl.textContent = name;
      subEl.textContent = 'Contenido de la lección';
      player.textContent = '';
      const videoMap = {
        tv: 'https://www.youtube.com/embed/pxPCdjDX7lQ',
        chart: 'https://www.youtube.com/embed/pxPCdjDX7lQ',
        sr: 'https://www.youtube.com/embed/pxPCdjDX7lQ',
        trend: 'https://www.youtube.com/embed/pxPCdjDX7lQ',
        vrvp: 'https://www.youtube.com/embed/pxPCdjDX7lQ'
      };
      const id = item.querySelector('input').dataset.id;
      const url = videoMap[id] || 'https://www.youtube.com/embed/pxPCdjDX7lQ';
      const params = 'rel=0&modestbranding=1&controls=1&disablekb=1&iv_load_policy=3&fs=0';
      const embed = url.replace('https://www.youtube.com/embed/','https://www.youtube-nocookie.com/embed/') + '?' + params;
      player.innerHTML = `<iframe width="100%" height="100%" style="aspect-ratio:16/9;border:0;border-radius:12px" src="${embed}" sandbox="allow-same-origin allow-scripts" referrerpolicy="no-referrer"></iframe>`;
    });

    // Intro
    (function loadIntro(){
      const intro = document.getElementById('introPlayer');
      if(!intro) return;
      const base = 'https://www.youtube-nocookie.com/embed/pxPCdjDX7lQ';
      const params = 'rel=0&modestbranding=1&disablekb=1&iv_load_policy=3&fs=0';
      intro.innerHTML = `<iframe width="100%" height="100%" style="aspect-ratio:16/9;border:0;border-radius:12px" src="${base + '?' + params}" sandbox="allow-same-origin allow-scripts" referrerpolicy="no-referrer" title="Presentación"></iframe>`;
    })();
  </script>
</body>
</html>
